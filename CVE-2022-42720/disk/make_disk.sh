#!/bin/bash
#### Create a hard drive containing a debian root filesystem with required exploit files.
#### This script is a wrapper to `create-image.sh` and requires the following files to run the exploit:
#### 1. libpcap.so.1.10.1 - libpcap library dependency for running the exploit binary
#### 2. poc.pcap - exploit wifi beacon frames
#### 3. xpl - exploit binary code


pcap=poc.pcap
libpcap=libpcap.so.1.10.1
xpl=xpl

if [ ! -f ${pcap} ]; then
    echo "pcap file '${pcap}' was not found, try copying it to the current working directory" 
    exit 1
fi

if [ ! -f ${libpcap} ]; then
    echo "libpcap library file '${libpcap}' was not found, try copying it to the current working directory"
    exit 2
fi

if [ ! -f ${xpl} ]; then
    echo "exploit binary file '${xpl}' was not found, try building it with the command: 'gcc -o xpl CVE-2022-42720.c \$(pkg-config --cflags --libs libnl-3.0 libnl-genl-3.0 libpcap)' then copying it to the current working directory"
    exit 3
fi

echo "All pre-requisite files were found, attempting to run 'create-image.sh' from ../../CVE-2022-41674/create-image.sh"

../../CVE-2022-41674/create-image.sh
